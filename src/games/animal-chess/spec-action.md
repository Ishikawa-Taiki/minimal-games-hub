# アニマルチェス: アクション仕様

## 概要

このドキュメントは、アニマルチェスゲームにおけるプレイヤーのアクションと、それに対するシステムの応答を定義します。

## 状態

-   **待機中 (Waiting for Input):** プレイヤーの操作を待っている状態。
-   **駒選択中 (Piece Selected):** プレイヤーが自分の駒を1つ選択している状態。
-   **持ち駒選択中 (Capture Selected):** プレイヤーが自分の持ち駒を1つ選択している状態。
-   **ゲーム終了 (Game Over):** いずれかのプレイヤーが勝利条件を満たした状態。

## アクション

### 1. 盤上のセルをクリック

-   **条件:** 状態が「待機中」
-   **操作:** プレイヤーが盤上のセルをクリックする。
-   **応答:**
    -   もしセルに自分の駒が存在すれば、その駒を選択し、状態を「駒選択中」に遷移する。
        -   選択された駒はハイライトされる。
        -   **ヒント機能 (ONの場合):** システムは選択された駒に基づいて、移動可能なマス、キャプチャ可能なマス、脅威にさらされるマスを計算し、ハイライト表示する。
    -   もしセルが空、または相手の駒であれば、何も起こらない。

-   **条件:** 状態が「駒選択中」
-   **操作:** プレイヤーが盤上のセルをクリックする。
-   **応答:**
    -   もしセルが、選択中の駒の有効な移動先であれば、駒をそのセルに移動させる。
        -   移動先に相手の駒があれば、その駒を捕獲し、自分の持ち駒に加える。
        -   移動後、手番を相手プレイヤーに交代し、状態を「待機中」に戻す。
        -   全てのヒントハイライトはクリアされる。
        -   ヒヨコが最終段に到達した場合、「ニワトリ」に成る。
        -   勝利条件が満されたかチェックし、満たされていれば状態を「ゲーム終了」に遷移させる。
    -   もしクリックしたセルが、現在選択中の別の自駒であれば、選択をその駒に切り替える。
        -   新しい駒に基づいてヒントが再計算され、表示される。
    -   もしクリックしたセルが、現在選択中の駒と同じセルであれば、駒の選択を解除し、状態を「待機中」に戻す。
        -   全てのヒントハイライトはクリアされる。
    -   もしセルが有効な移動先でなければ、何も起こらない。

-   **条件:** 状態が「持ち駒選択中」
-   **操作:** プレイヤーが盤上のセルをクリックする。
-   **応答:**
    -   もしセルが空きマスであれば、選択中の持ち駒をそのセルに配置する（打つ）。
        -   手番を相手プレイヤーに交代し、状態を「待機中」に戻す。
        -   全てのヒントハイライトはクリアされる。
    -   もしセルが空きマスでなければ、何も起こらない。

### 2. 持ち駒をクリック

-   **条件:** 状態が「待機中」または「駒選択中」
-   **操作:** プレイヤーが自分の持ち駒リストにある駒をクリックする。
-   **応答:**
    -   盤上の駒の選択は解除され、全てのヒントハイライトもクリアされる。
    -   クリックされた持ち駒を選択し、状態を「持ち駒選択中」に遷移する。
    -   選択された持ち駒はハイライトされる。
    -   **ヒント機能 (ONの場合):** 配置可能なマス（全ての空きマス）がハイライト表示される。

### 3. 「リセット」ボタンをクリック

-   **条件:** 任意のタイミング
-   **操作:** プレイヤーが「リセット」ボタンをクリックする。
-   **応答:**
    -   ゲームの状態を全て初期状態に戻し、ヒントもクリアされる。
    -   手番は先手（プレイヤー1）になる。

### 4. 「ヒント」ボタンをクリック

-   **条件:** 任意のタイミング
-   **操作:** プレイヤーが「ヒント」ボタンをクリックする。
-   **応答:**
    -   ヒント機能のON/OFFを切り替える。
    -   OFFにした場合、表示されている全てのヒントハイライトがクリアされる。
    -   ONにした場合、もし駒が選択されていれば、その駒のヒントが計算され表示される。
