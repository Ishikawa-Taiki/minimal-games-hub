# アニマルチェス システム動作仕様

## 1. ゲームの状態管理
システムは、ゲームを正しく進行させるために、以下の情報を常に記憶・管理します。

- **盤面の状態:** 3x4の各マスに、どの駒が存在するか、または空か。駒は `{ type: PieceType, owner: Player }` という形式で管理されます。
  - `PieceType`: 'LION', 'GIRAFFE', 'ELEPHANT', 'CHICK', 'ROOSTER' のいずれか。
  - `Player`: 'OKASHI' (おかしチーム) または 'OHANA' (おはなチーム) のいずれか。
- **持ち駒:** 各プレイヤー (`OKASHI`, `OHANA`) が、どの種類の駒(`PieceType`)を配列として保持しているか。
- **手番:** 現在、どちらのプレイヤー (`OKASHI` または `OHANA`) の手番であるか。
- **ゲーム状況:** ゲームが「プレイ中」または「勝利」のいずれの状態にあるか。
- **勝者と理由:** 勝利が確定した場合、どちらのプレイヤーが、どの理由（キャッチまたはトライ）で勝利したか。

## 2. ゲームの初期化
ゲームが開始される（またはリセットされる）際、システムは状態を以下のように設定します。

- **盤面の状態:** ルールで定められた初期配置に駒をセットします。
- **持ち駒:** 両プレイヤーの持ち駒リストを空の状態にします。
- **手番:** 先手である `'OKASHI'` に設定します。
- **ゲーム状況:** 「プレイ中」に設定します。

## 3. プレイヤーの操作と状態遷移
プレイヤーの操作は、「盤上の駒を動かす」または「持ち駒を打つ」の2種類です。システムはプレイヤーの入力（例：マスの選択）に応じて、これらの操作を解釈し、状態を遷移させます。

### 3.1. 盤上の駒を動かす
1.  **操作の検証:**
    -   選択された駒が、現在の手番プレイヤーのものであることを確認します。
    -   移動先のマスが、その駒のルール上有効な移動先であることを確認します。
2.  **盤面の更新:**
    -   検証を通過した場合、駒を選択元のマスから移動先のマスへ動かします。
    -   移動先に相手の駒がいた場合、その駒を盤上から取り除き、現在の手番プレイヤーの持ち駒に加えます。「ニワトリ」を捕獲した場合、持ち駒としては「ヒヨコ」として加えます。
3.  **「成り」の処理:**
    -   移動した駒が「ヒヨコ」であり、かつ移動先が相手陣地の最終ラインであった場合、その駒を「ニワトリ」に成らせます。
4.  **勝利判定:**
    -   盤面の更新後、勝利条件が満たされたかを確認します。
    -   **キャッチ:** 相手の「ライオン」を捕獲した場合。
    -   **トライ:** 自分の「ライオン」が相手陣地の最終ラインに到達した場合。
    -   いずれかの条件が満たされた場合、ゲーム状況を「勝利」とし、勝者と勝利理由を記録します。
5.  **手番の交代:**
    -   勝利が確定しなかった場合、手番を相手プレイヤーに交代します。

### 3.2. 持ち駒を打つ
1.  **操作の検証:**
    -   選択された持ち駒が、現在の手番プレイヤーのものであることを確認します。
    -   配置先のマスが、盤上の空きマスであることを確認します。
    -   持ち駒が「ヒヨコ」の場合、配置先が相手陣地の最終ラインでないことを確認します。
2.  **盤面の更新:**
    -   検証を通過した場合、選択された持ち駒をプレイヤーの持ち駒リストから削除し、指定された空きマスに配置します。
3.  **勝利判定:**
    -   持ち駒を打つことによって勝利条件が満たされることはルール上ないため、判定は行いません。
4.  **手番の交代:**
    -   手番を相手プレイヤーに交代します。

## 4. 不正な操作への対応
プレイヤーがルール上許可されていない操作を行った場合、システムはその操作を無視し、ゲームの状態は一切変更されません。
- **例:**
  - 自分の手番ではないときに駒を動かそうとする。
  - 駒の移動範囲外のマスを選択する。
  - 駒が既に存在するマスに持ち駒を打とうとする。
  - 禁止された場所に「ヒヨコ」を打とうとする。

---
## 本資料で定義すべきこと
- 千日手（同じ局面が4回出現するなど）や、連続王手の千日手といった、特殊な引き分けに関するルールの要否、およびそれを判定するためのロジック。現在の実装には含まれていないため、導入する場合は詳細な仕様定義が必要です。
