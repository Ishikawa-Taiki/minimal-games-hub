# リバーシ システム動作仕様

## 1. ゲームの状態管理
システムは、以下の情報を常に記憶します。
- 8x8の盤面の各マスが「黒の石」「白の石」「空」のいずれであるか。
- 現在の手番は黒か白か。
- 黒と白、それぞれの現在の石の数。
- ゲームの進行状況（プレイ中、パス発生、決着）。
- 現在の手番のプレイヤーが石を置けるすべてのマスと、その場合にひっくり返せる相手の石の情報のリスト。
- 「おしえて！」機能（ぜんぶヒント）のON/OFF状態。

## 2. ゲームの初期化
ゲーム開始時、システムは以下の状態になります。
- 盤面の中央4マスに、黒と白の石を2つずつ交互に配置します。
- 他のマスはすべて「空」の状態です。
- 最初の手番は黒です。
- スコアは黒2点、白2点です。
- ゲームはプレイ中の状態です。
- 「おしえて！」機能はOFFです。

## 3. プレイヤーの操作と状態遷移
プレイヤーが盤面のいずれかのマスを選択した際のシステムの応答は、「おしえて！」機能のON/OFF状態によって変化します。

- **「おしえて！」機能がOFFの場合（デフォルト）:**
    1.  選択されたマスが、現在の手番のプレイヤーが石を置ける有効なマスであることを確認します。
    2.  条件を満たす場合、そのマスに石を配置し、ルールに従い相手の石をひっくり返します。
    3.  スコアを更新し、手番を交代します。
- **「おしえて！」機能がONの場合:**
    1.  **1回目のタップ:** 選択されたマスが有効な手である場合、そのマスに石を置いた場合にひっくり返る相手の石をプレビュー表示します。ゲームの状態はまだ変更されません。
    2.  **2回目のタップ:** 同じマスを再度タップすると、石の配置を確定し、相手の石をひっくり返します。その後、スコアを更新し、手番を交代します。プレビュー中に別の有効なマスをタップした場合は、プレビュー対象がその新しいマスに切り替わります。

## 4. ゲームの進行ルール
- **パス:**
    - 手番が移ったプレイヤーに、石を置ける有効なマスが一つもない場合、手番は自動的に元のプレイヤーに戻ります（パスとなります）。
- **ゲーム終了:**
    - 盤面のすべてのマスが石で埋まった場合、ゲームは終了します。
    - 両プレイヤーともに、石を置ける有効なマスがなくなった場合、ゲームは終了します。
- **勝敗決定:**
    - ゲーム終了時に、より多くの石を持っているプレイヤーを勝者とします。同数の場合は引き分けです。

## 5. 「おしえて！」機能の操作
プレイヤーが「おしえて！」ボタンを押すたびに、「ぜんぶヒント」機能のON/OFFが切り替わります。
- **デフォルト（OFF）:** 石を置ける場所がハイライトされる基本表示です。
- **ON:** 「ぜんぶヒント」モード。石を置けるマスと、そこで返せる石の数が表示され、操作が2段階タップになります。

## 6. 不正な操作への対応
- プレイヤーが石を置けないマスを選択した場合、システムはその操作を無視し、ゲームの状態は一切変化しません。
- 駒がひっくり返るアニメーションの再生中は、プレイヤーは盤面への新たな操作を行うことはできません。システムは、この間の操作をすべて無視します。

## 7. ゲームの再初期化
プレイヤーが「はじめからやりなおす」ボタンを押した場合、システムはゲームの状態を「2. ゲームの初期化」で定義された状態にリセットします。「おしえて！」機能の状態もOFFにリセットされます。
