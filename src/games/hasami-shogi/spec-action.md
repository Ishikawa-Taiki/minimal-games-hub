# はさみ将棋 システム動作仕様

## 1. ゲームの状態管理
システムは、ゲームを正しく進行させるために、以下の情報を常に記憶・管理します。

- **勝利条件:** ゲーム開始前に選択された勝利条件（「5個先取」など）。
- **盤面の状態:** 9x9の各マスに、どちらのプレイヤーの駒が存在するか、または空か。
- **手番:** 現在、どちらのプレイヤーの手番であるか。
- **捕獲した駒の数:** 各プレイヤーが、相手の駒を何個捕獲したか。
- **ゲーム状況:** ゲームが「プレイ前」「プレイ中」「結果表示中」のいずれの状態にあるか。

## 2. ゲームの初期化
ゲームが開始される（またはリセット、勝利条件が変更される）際、システムは状態を以下のように設定します。

1.  **盤面の配置:** 9x9の盤の最上段と最下段に、それぞれ9個ずつ駒を配置します。
2.  **状態の初期化:**
    -   両プレイヤーの「捕獲した駒の数」を0にします。
    -   手番を先手プレイヤーに設定します。
    -   ゲーム状況を「プレイ中」にします。

## 3. プレイヤーの操作と状態遷移
プレイヤーが自分の駒を選択し、移動先のマスを選択した際、システムは以下の手順で処理を実行します。

1.  **操作の検証:**
    -   選択した駒が、現在の手番プレイヤーのものであることを確認します。
    -   移動先が、駒の移動ルール（縦横の直線で、他の駒を飛び越えない）に従っていることを確認します。
2.  **盤面の更新:**
    -   検証を通過した場合、駒を選択元のマスから移動先のマスへ動かします。
3.  **捕獲の処理:**
    -   駒の移動後、移動先のマスの周囲（縦横）を確認し、相手の駒を挟んでいないか判定します。
    -   挟まれている相手の駒を発見した場合、それらをすべて盤上から取り除き、自プレイヤーの「捕獲した駒の数」に加算します。
4.  **勝利判定:**
    -   捕獲処理後、現在の「捕獲した駒の数」が、設定された勝利条件を満たしているか判定します。
    -   **例（「5個先取」ルールの場合）:** 自分の「捕獲した駒の数」が5個に達したか確認します。
    -   勝利条件が満たされた場合、ゲーム状況を「結果表示中」とし、勝者を記録します。
5.  **手番の交代:**
    -   勝利が確定しなかった場合、手番を相手プレイヤーに交代します。

## 4. 不正な操作への対応
プレイヤーがルール上許可されていない操作を行った場合、システムはその操作を無視し、ゲームの状態は一切変更されません。
- **例:**
  - 自分の手番ではないときに駒を動かそうとする。
  - 斜めに動かそうとしたり、他の駒を飛び越えようとする。
  - 駒のないマスを選択する。

---
## 本資料で定義すべきこと
- 勝利条件の各ルールの詳細なロジック（例：「3個差」ルールの正確な判定タイミング）。
- 駒やマスを特定するための内部的なデータ表現（例：{ x: 0, y: 0, owner: 'Player1' }）。
- 千日手など、ゲームが無限に続く可能性のある状態への対応策。
