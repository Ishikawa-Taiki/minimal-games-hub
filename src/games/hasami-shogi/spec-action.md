# はさみ将棋 システム動作仕様

## 1. ゲームの状態管理
システムは、ゲームを正しく進行させるために、以下の情報を常に記憶・管理します。

- **勝利条件:** `'standard'`, `'five_captures'`, `'total_capture'` のいずれか。
- **盤面の状態:** 9x9の各マスに、どちらのプレイヤー (`'PLAYER1'` または `'PLAYER2'`) のコマが存在するか、または空か。
- **手番:** 現在、どちらのプレイヤー (`'PLAYER1'` または `'PLAYER2'`) の手番であるか。
- **捕獲したコマの数:** 各プレイヤーが、相手のコマを何個捕獲したか。
- **ゲーム状況:** ゲームが「プレイ前」「プレイ中」「結果表示中」のいずれの状態にあるか。

## 2. ゲームの初期化
ゲームが開始される（またはリセット、勝利条件が変更される）際、システムは状態を以下のように設定します。

1.  **盤面の配置:** 9x9の盤の最上段に `'PLAYER2'` のコマを、最下段に `'PLAYER1'` のコマを、それぞれ9個ずつ配置します。
2.  **状態の初期化:**
    -   両プレイヤーの「捕獲したコマの数」を0にします。
    -   手番を `'PLAYER1'` に設定します。
    -   ゲーム状況を「プレイ中」にします。

## 3. プレイヤーの操作と状態遷移
プレイヤーが自分のコマを選択し、移動先のマスを選択した際、システムは以下の手順で処理を実行します。

1.  **操作の検証:**
    -   選択したコマが、現在の手番プレイヤーのものであることを確認します。
    -   移動先が、コマの移動ルール（縦横の直線で、他のコマを飛び越えない）に従っていることを確認します。
2.  **盤面の更新:**
    -   検証を通過した場合、コマを選択元のマスから移動先のマスへ動かします。
3.  **捕獲の処理:**
    -   コマの移動後、移動先のマスの周囲（縦横）を確認し、相手のコマを挟んでいないか判定します。
    -   挟まれている相手のコマを発見した場合、それらをすべて盤上から取り除き、自プレイヤーの「捕獲したコマの数」に加算します。
4.  **勝利判定:**
    -   捕獲処理後、現在の「捕獲したコマの数」が、設定された勝利条件を満たしているか判定します。
    -   **例（「5個先取」ルールの場合）:** 自分の「捕獲したコマの数」が5個に達したか確認します。
    -   勝利条件が満たされた場合、ゲーム状況を「結果表示中」とし、勝者を記録します。
5.  **手番の交代:**
    -   勝利が確定しなかった場合、手番を相手プレイヤーに交代します。

## 4. 無効な操作とコンソールエラー
プレイヤーがルール上許可されていない操作を行った場合、システムはその操作を無視してゲームの状態を変更せず、開発者コンソールにエラーメッセージを出力します。

| シナリオ | コンソールエラーメッセージ |
| :--- | :--- |
| ゲームが終了した後にセルをクリックしようとする | `Invalid action: The game is already over.` |
| 選択した駒を、ルール上移動できないマスに移動しようとする（斜め移動、駒の飛び越え、味方の駒のマスなど） | `Invalid move: Cannot move piece from (from_row, from_col) to (to_row, to_col).` |

---
## 本資料で定義すべきこと
- 千日手など、ゲームが無限に続く可能性のある状態への対応策。現在の実装には含まれていないため、導入する場合は詳細な仕様定義が必要です。
