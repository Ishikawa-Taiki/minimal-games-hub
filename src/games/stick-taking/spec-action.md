# 棒取りゲーム システム動作仕様

## 1. ゲームの状態管理
システムは、ゲームを正しく進行させるために、以下の情報を常に記憶・管理します。

- **難易度:** 「かんたん」「ふつう」「むずかしい」のいずれか。
- **棒の状態:** 各段に、それぞれ何本の棒が残っているか。
- **手番:** 現在、どちらのプレイヤー (`'プレイヤー1'` または `'プレイヤー2'`) の手番であるか。
- **ゲーム状況:** ゲームが「プレイ前」「プレイ中」「結果表示中」のいずれの状態にあるか。

## 2. ゲームの初期化
ゲームが開始される（またはリセット、難易度変更される）際、システムは状態を以下のように設定します。

1.  **棒の配置:** 選択された難易度 `'easy'`, `'normal'`, `'hard'` に応じて、各段の棒の本数を配列として設定します。
    - **easy:** `[1, 2, 3]`
    - **normal:** `[1, 2, 3, 4, 5]`
    - **hard:** `[1, 2, 3, 4, 5, 6, 7]`
2.  **状態の初期化:**
    -   手番を `'プレイヤー1'` に設定します。
    -   ゲーム状況を「プレイ中」にします。

## 3. プレイヤーの操作と状態遷移
プレイヤーが特定の段の棒を1本以上選択し、「棒を消す」操作を確定した際、システムは以下の手順で処理を実行します。

1.  **操作の検証:**
    -   選択された棒が、すべて同じ段に属していることを確認します。
    -   1本以上の棒が選択されていることを確認します。
2.  **棒の状態の更新:**
    -   検証を通過した場合、対象の段の棒の残り本数から、選択された本数を減算します。
3.  **ゲーム終了判定:**
    -   棒の状態を更新した後、盤上のすべての棒の合計本数が0になったかを確認します。
    -   合計本数が0になった場合、ゲーム状況を「結果表示中」に遷移させます。
    -   この場合、**最後に操作を行った現在の手番プレイヤーが敗者**となり、相手プレイヤーが勝者となります。
4.  **手番の交代:**
    -   勝利が確定しなかった場合、手番を相手プレイヤーに交代します。

## 4. 不正な操作への対応
プレイヤーがルール上許可されていない操作を行った場合、システムはその操作を無視し、ゲームの状態は一切変更されません。
- **例:**
  - 複数の段にまたがって棒を選択しようとする。
  - 1本も棒を選択せずに「棒を消す」操作をしようとする。

---
## 本資料で定義すべきこと
- 本仕様書に記載されている内容は、現在の実装と一致しており、現時点で追加で定義すべき主要な項目はありません。
