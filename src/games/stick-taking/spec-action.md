# 棒消しゲーム システム動作仕様

## 1. ゲームの状態管理
システムは、ゲームを正しく進行させるために、以下の情報を常に記憶・管理します。

- **難易度:** 「かんたん」「ふつう」「むずかしい」のいずれか。
- **棒の状態:** 各段に、それぞれ何本の棒が残っているか。
- **手番:** 現在、どちらのプレイヤー (`'プレイヤー1'` または `'プレイヤー2'`) の手番であるか。
- **ゲーム状況:** ゲームが「プレイ前」「プレイ中」「結果表示中」のいずれの状態にあるか。

## 2. ゲームの初期化
ゲームが開始される（またはリセット、難易度変更される）際、システムは状態を以下のように設定します。

1.  **棒の配置:** 選択された難易度 `'easy'`, `'normal'`, `'hard'` に応じて、各段の棒の本数を配列として設定します。
    - **easy:** `[1, 2, 3]`
    - **normal:** `[1, 2, 3, 4, 5]`
    - **hard:** `[1, 2, 3, 4, 5, 6, 7]`
2.  **状態の初期化:**
    -   手番を `'プレイヤー1'` に設定します。
    -   ゲーム状況を「プレイ中」にします。

## 3. プレイヤーの操作と状態遷移
プレイヤーが特定の段の棒を1本以上選択し、「棒を消す」操作を確定した際、システムは以下の手順で処理を実行します。

1.  **操作の検証:**
    -   選択された棒が、すべて同じ段に属していることを確認します。
    -   1本以上の棒が選択されていることを確認します。
2.  **棒の状態の更新:**
    -   検証を通過した場合、対象の段の棒の残り本数から、選択された本数を減算します。
3.  **ゲーム終了判定:**
    -   棒の状態を更新した後、盤上のすべての棒の合計本数が0になったかを確認します。
    -   合計本数が0になった場合、ゲーム状況を「結果表示中」に遷移させます。
    -   この場合、**最後に操作を行った現在の手番プレイヤーが敗者**となり、相手プレイヤーが勝者となります。
4.  **手番の交代:**
    -   勝利が確定しなかった場合、手番を相手プレイヤーに交代します。

## 4. 不正な操作への対応
- プレイヤーがルール上許可されていない操作を行った場合、システムはその操作を無視し、ゲームの状態は一切変更されません。
  - **例:**
    - 複数の段にまたがって棒を選択しようとする。
    - 1本も棒を選択せずに「棒を消す」操作をしようとする。
- 選択済みの棒のうち両端以外を操作した場合、操作開始時点ですべての選択が解除されます。(そのままドラッグを開始した場合、通常通り通過した棒はすべて選択状態になります。)

## 5. ヒント機能の操作
- プレイヤーは「おしえて！」ボタンをクリックすることで、ヒント情報の表示／非表示をいつでも切り替えることができます。
- ヒントの具体的な表示内容については、プロジェクト共通の技術ガイド `docs/rules/spec-hint.md` を参照してください。

## 6. 棒の選択操作
プレイヤーは、以下の方法で同じ段にある棒を選択できます。PC（マウス）とモバイル（タッチ）で、一貫した操作性を提供します。

- **単一選択（クリック／タップ）**
  -   **操作:** 棒を1本クリック、またはタップします。
  -   **動作:**
      -   その棒が選択されていない場合、選択状態になります。この時、隣り合う棒以外が選択された場合は、今まで選択していた棒の選択が解除されます。
      -   その棒が既に選択されている場合、選択が解除されます。この時、選択区間中の両端以外の棒が選択された場合は、今まで選択していた棒の選択がすべて解除されます。

- **範囲選択（ドラッグ／スワイプ）**
  -   **操作:** 同じ段にある複数の棒の上を、マウスドラッグ（ボタンを押したまま移動）、または指でスワイプ（画面に触れたまま移動）します。
  -   **動作:**
      -   操作を開始した棒の選択状態（選択／非選択）に応じて、通過したすべての棒が同じ状態に設定されます。
      -   例えば、未選択の棒からドラッグを開始した場合、通過した棒はすべて選択状態になります。
      -   例えば、選択済みの棒からドラッグを開始した場合、通過した棒はすべて選択解除されます。

---
## 本資料で定義すべきこと
- 本仕様書に記載されている内容は、現在の実装と一致しており、現時点で追加で定義すべき主要な項目はありません。
