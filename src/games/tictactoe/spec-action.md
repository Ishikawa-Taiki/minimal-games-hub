# 三目並べ システム動作仕様

## 1. ゲームの状態管理
システムは、ゲームを正しく進行させるために、以下の情報を常に記憶・管理します。

- **盤面の状態:** 3x3の各マスが `'X'`, `'O'`, または `null` (空) のいずれであるか。
- **手番:** 現在、どちらのプレイヤー (`'X'` または `'O'`) の手番であるか。
- **ゲーム状況:** ゲームが「プレイ中」「結果表示中」のいずれの状態にあるか。
- **勝者:** ゲームが終了した場合、どちらのプレイヤー (`'X'`, `'O'`) が勝利したか、あるいは `'DRAW'` (引き分け) か。

## 2. ゲームの初期化
ゲームが開始される（またはリセットされる）際、システムは状態を以下のように設定します。

- **盤面の状態:** すべてのマスを `null` (空) にします。
- **手番:** `'O'` に設定します。
- **ゲーム状況:** 「プレイ中」に設定します。

## 3. プレイヤーの操作と状態遷移
プレイヤーが盤上の空きマスを1つ選択した際、システムは以下の手順で処理を実行します。

1.  **操作の検証:**
    -   選択されたマスが空 (`null`) であることを確認します。
    -   ゲームが終了していないことを確認します。
2.  **盤面の更新:**
    -   検証を通過した場合、選択されたマスに、現在の手番プレイヤーのマーク (`'X'` または `'O'`) を配置します。
3.  **勝利判定:**
    -   盤面の更新後、いずれかのプレイヤーが縦・横・斜めのいずれかで3マスを揃えたか判定します。
    -   勝利が確定した場合、ゲーム状況を「結果表示中」とし、勝者を記録します。
4.  **引き分け判定:**
    -   勝利が確定せず、かつ盤上のすべてのマスが埋まった場合、ゲーム状況を「結果表示中」とし、結果を `'DRAW'` (引き分け) として記録します。
5.  **手番の交代:**
    -   勝利も引き分けも確定しなかった場合、手番を相手プレイヤーに交代します。

## 4. 無効な操作とコンソールエラー
プレイヤーがルール上許可されていない操作を行った場合、システムはその操作を無視してゲームの状態を変更せず、開発者コンソールにエラーメッセージを出力します。

| シナリオ | コンソールエラーメッセージ |
| :--- | :--- |
| ゲームが終了した後にセルをクリックしようとする | `Invalid action: The game is already over.` |
| すでにマークが置かれているマスをクリックする | `Invalid action: Cell (row, col) is already marked.` |
