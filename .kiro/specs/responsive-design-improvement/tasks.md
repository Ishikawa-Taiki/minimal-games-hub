# 実装計画

## フェーズ1: 基盤システム + 1ゲーム完成（動作確認可能）

- [x] 1. 基盤整備：最小限の型定義システムの構築
  - 基本的な共通型定義（BaseGameState、BaseGameController）を`types/game.ts`に実装
  - レスポンシブ型（ResponsiveState）の基本実装
  - _要件: 3.1, 3.4_

- [x] 2. レスポンシブ検出システムの基本実装
  - ブレークポイント（768px）を基準とした`useResponsive`フックの基本実装
  - 型安全なヘルパー関数（isMobile、isDesktop）を実装
  - _要件: 4.1, 4.2, 6.1_

- [x] 3. 最小限の共通UIコンポーネント実装
  - 基本的なButtonコンポーネントを実装
  - 基本的なModalコンポーネントを実装
  - _要件: 5.1, 6.2_

- [x] 4. 基本GameLayoutコンポーネントの実装
  - レスポンシブ対応の基本GameLayoutコンポーネントを実装
  - PC: サイドバーレイアウト、モバイル: ミニマルレイアウトの基本形を実装
  - _要件: 1.1, 1.2, 2.1, 2.2, 3.3_

- [x] 5. 1つのゲーム（三目並べ）での動作確認
  - 三目並べゲームを新しいGameLayoutに対応させる
  - 基本的なレスポンシブ動作を確認
  - PC/モバイルでの表示切り替えをテスト
  - _要件: 3.1, 3.2, 4.1, 4.5_

## フェーズ2: モバイルUI強化 + 追加ゲーム対応

- [x] 6. モバイルUI強化：FAB + ボトムシート実装
  - フローティングアクションボタン（FAB）コンポーネントを実装
  - ボトムシート/モーダルコンポーネント（スライドアップアニメーション付き）を実装
  - FABタップ時のコントロールパネル表示機能を実装
  - _要件: 2.3, 2.4, 2.5_

- [x] 7. ヒント機能の型定義拡張
  - ヒント機能の実態に基づいた型定義（HintState、HintOverlayData）を実装
  - HintableGameControllerインターフェースを実装
  - _要件: 3.5_

- [x] 8. 既存ゲーム（リバーシ）の完全対応【完了】
  - リバーシゲームのuseReversiフックをGameControllerインターフェースに準拠させる
  - ヒント機能（placeable、full）を新しいHintStateに対応させる
  - 履歴機能（undo/redo）をHistoryGameControllerに対応させる（一時無効化、後で完全実装予定）
  - 強化されたGameLayoutコンポーネントを適用
  - **解決**: レスポンシブレイアウト、ヒント機能、手番表示の問題を修正
  - **追加**: 状態監視ログシステムとデバッグUIを実装
  - _要件: 3.1, 3.2, 3.5_

## フェーズ3: 残りゲームの一括対応

**重要な考慮事項**:
- **テスト戦略**: 各ゲーム移行時に必ずユニットテスト + E2Eテストを実装
- **段階的実装**: 1ゲームずつ移行し、各段階でテスト確認
- **既存機能保持**: 移行前の機能が全て動作することを確認
- **参考実装**: リバーシ（useReversi.ts）と○×ゲーム（useTicTacToeController）の実装パターンを参考
- **共通パターン**: BaseGameController、HintableGameController、HistoryGameControllerインターフェースへの準拠

- [ ] 9. 既存ゲーム（はさみ将棋）のGameController対応
  - はさみ将棋ゲームのuseHasamiShogiフックをGameControllerインターフェースに準拠させる
  - ヒント機能を新しいHintStateに対応させる
  - 新しいGameLayoutコンポーネントを適用
  - **必須**: @testing-library/reactによるフックテスト実装
  - _要件: 3.1, 3.2, 3.5_

- [ ] 10. 既存ゲーム（アニマルチェス）のGameController対応
  - アニマルチェスゲームのuseAnimalChessフックをGameControllerインターフェースに準拠させる
  - ヒント機能を新しいHintStateに対応させる
  - 新しいGameLayoutコンポーネントを適用
  - **必須**: @testing-library/reactによるフックテスト実装
  - _要件: 3.1, 3.2, 3.5_

- [ ] 11. 既存ゲーム（神経衰弱）のGameController対応
  - 神経衰弱ゲームのuseConcentrationフックをGameControllerインターフェースに準拠させる
  - ヒント機能を新しいHintStateに対応させる
  - 新しいGameLayoutコンポーネントを適用
  - **必須**: @testing-library/reactによるフックテスト実装
  - _要件: 3.1, 3.2, 3.5_

- [ ] 12. 既存ゲーム（棒取りゲーム）のGameController対応
  - 棒取りゲームのuseStickTakingフックをGameControllerインターフェースに準拠させる
  - 新しいGameLayoutコンポーネントを適用
  - **必須**: @testing-library/reactによるフックテスト実装
  - _要件: 3.1, 3.2, 3.5_

## フェーズ4: 全体最適化とホームページ対応

- [ ] 13. ホームページのレスポンシブ対応
  - ホームページのゲームグリッドをレスポンシブ対応（PC: 2-3列、モバイル: 1列）
  - 統一されたUIコンポーネントを適用
  - タッチフレンドリーなボタンサイズとスペーシングを実装
  - _要件: 1.5, 2.6, 5.1, 5.2_

- [ ] 14. UIコンポーネントライブラリの完成
  - 統一されたデザインシステム（色、フォント、間隔）を`app/styles/`に構築
  - ゲーム内ヒント表示用HintOverlayコンポーネントを実装
  - アクセシビリティ対応の強化
  - _要件: 5.2, 5.3, 6.2, 6.3_

- [ ] 15. アクセシビリティとタッチ対応の実装
  - すべてのインタラクティブ要素にタッチフレンドリーなサイズ（最小44px）を適用
  - 視覚的フィードバック（ホバー、アクティブ状態）を実装
  - キーボードナビゲーション対応を実装
  - スクリーンリーダー対応（aria-label、role属性）を実装
  - _要件: 5.1, 5.3, 5.4_

## フェーズ5: 最適化とテスト

- [ ] 16. パフォーマンス最適化
  - レスポンシブ計算のメモ化（useMemo、useCallback）を実装
  - CSS-in-JSスタイルオブジェクトのメモ化を実装
  - レイアウト切り替え時の不要な再レンダリング防止を実装
  - ボトムシートアニメーションのパフォーマンス最適化を実装
  - _要件: 4.5, 5.5_

- [ ] 17. ユニットテストの実装
  - レスポンシブフック（useResponsive）のテストを実装
  - GameControllerインターフェースの動作テストを実装
  - 共通UIコンポーネントのテストを実装
  - ヒント機能の状態管理テストを実装
  - _要件: 3.5, 6.4, 6.5_

- [ ] 18. インテグレーションテストの実装
  - レイアウト切り替え（ブラウザリサイズ）のテストを実装
  - ゲーム状態保持（レイアウト変更時）のテストを実装
  - FAB → ボトムシート → 操作の一連の流れのテストを実装
  - _要件: 4.1, 4.2, 4.5_

- [ ] 19. E2Eテストの実装
  - PC/モバイル表示切り替えのテストを実装
  - 各レイアウトでのゲーム操作のテストを実装
  - ページ遷移時のレイアウト保持のテストを実装
  - _要件: 5.4, 6.1, 6.2_

- [ ] 20. ブラウザ互換性とアクセシビリティ監査
  - 主要ブラウザ（Chrome、Firefox、Safari、Edge）での動作確認を実施
  - モバイルブラウザ（iOS Safari、Android Chrome）での動作確認を実施
  - アクセシビリティ監査（WCAG 2.1 AA準拠）を実施
  - _要件: 5.2, 5.4, 6.5_

- [ ] 21. ドキュメント更新と最終調整
  - アーキテクチャドキュメントの更新（新しい共通システムの説明）
  - 各ゲームのspec-display.mdの更新（レスポンシブ対応の記載）
  - 開発者向けガイドの更新（新しいGameControllerの使用方法）
  - 最終的なスタイル調整とポリッシュ
  - _要件: 3.4, 6.3_