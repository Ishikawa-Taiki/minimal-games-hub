# 技術ガイド (TECHNICAL GUIDE)

本ドキュメントは、プロジェクトの技術的なルールと規約を定義します。AIは常にこれらのガイドラインを遵守しなければなりません。

## 1. 環境構築

### Node.jsバージョン管理
本プロジェクトでは、Node.jsのバージョン管理に`nodenv`を使用しています。`.node-version`ファイルに指定されたバージョンを使用してください。

```bash
# プロジェクトで使用するNode.jsバージョンをインストール
nodenv install

# プロジェクトディレクトリでバージョンを有効化
nodenv local
```

### 依存関係のインストール
プロジェクトのルートディレクトリで、以下のコマンドを実行して依存関係をインストールします。

```bash
npm install
```

## 2. 開発サイクル

### 開発サーバーの起動
以下のコマンドを実行すると、開発サーバーが起動し、ブラウザでアプリケーションを確認できます。

```bash
npm run dev
```

### ビルド
本プロジェクトは静的サイトとしてエクスポートされます。以下のコマンドでビルドを実行できます。

```bash
npm run build
```

## 3. 技術スタック
-   **フレームワーク:** Next.js
-   **言語:** TypeScript
-   **スタイリング:** Tailwind CSS (`globals.css` と PostCSS経由)
-   **Node.jsバージョン管理:** `nodenv` (`.node-version` ファイルを参照)

## 4. コーディング規約
-   **リンティング & フォーマット:** `eslint.config.mjs` に定義されたルールに準拠します。
-   **型安全性:** すべてのコードはTypeScriptを用いて厳密に型付けされるべきです。

## 5. GitワークフローとAIの責務

-   **ブランチ:** 新規タスクの開始時、AIは人間の指示に基づき、適切な名前でフィーチャーブランチを作成します。
-   **コミット:** 作業の区切りで、AIは変更内容を要約したコミットメッセージ（日本語）を作成し、人間の承認を得てコミットを実行します。
-   **プッシュ:** AIは人間の指示に基づき、現在のブランチをリモートにプッシュします。
-   **PR提案:** コミットとプッシュが完了した後、AIは作業内容を要約したPRのタイトルと本文を自発的に提案します。
-   **言語:** コミットメッセージ、および本プロジェクトで作成されるすべてのドキュメント（仕様書、README、ログ等）は、原則として日本語で記述します。

## 6. セッション管理ワークフロー

本プロジェクトは `docs/ai-workflow/3-session-context.md` を単一エントリーポイントとします。AIは以下の責務を負います。

1.  **コンテキストの参照:** セッション開始時、AIはまず`docs/ai-workflow/3-session-context.md`を読み込み、現状を把握します。詳細情報が必要な場合は、そこからポインタをたどって各ドキュメントを参照します。
2.  **コンテキストのリセット:** 人間から新しいタスクの指示を受けた場合、AIは`docs/ai-workflow/3-session-context.md`の「現在のタスク」セクションを新しい内容でリセットします。
3.  **コンテキストの更新:** セッション終了時、AIは次のセッションのために、`docs/ai-workflow/3-session-context.md`を最新の作業状況（ブランチ、タスクの進捗など）で更新し、コミットに含めます。

## 7. ビルド & デプロイ
-   **デプロイ:** `main` ブランチへのマージごとに、`.github/workflows/deploy.yml` ワークフローによってGitHub Pagesへ自動的にデプロイされます。
-   **GitHub Pages設定:** デプロイが正しく機能するためには、リポジトリの `Settings > Pages` で、`Build and deployment` の `Source` が `GitHub Actions` に設定されている必要があります。

## 8. 仕様参照ルール
-   **ルール:** ゲームの実装や修正を開始する前に、AIは必ず対象ゲームのディレクトリ（`games/[slug]/`）に定義された仕様を最初に読み込み、完全に理解しなければなりません。これには `manifest.json` や `README.md` などが含まれますが、これに限定されません。AIはこれらの仕様に基づいて作業を行う必要があります。

## 9. 新規ゲーム開発ワークフロー

新しいゲームを開発する際は、以下のワークフローに従います。

1.  **ドキュメント作成と擦り合わせ:** まず、ゲームのルールとシステム仕様に関するドキュメント（例: `games/[slug]/rules.md`, `games/[slug]/spec.md`）を作成します。この段階で、人間とAIの間で疑問点を擦り合わせ、仕様を明確にします。AIは、人間からの追加情報や確認が必要な場合、積極的に質問を投げかけます。
2.  **コード実装:** ドキュメントによる仕様の擦り合わせが完了し、人間からの承認が得られた後、コードの実装を開始します。

## 10. ドキュメントの所有権と更新責務

プロジェクトの透明性と一貫性を維持するため、各ドキュメントの更新責任を人間とAIの間で明確に定義します。責任の所在が曖昧になることを防ぐため、以下のルールは厳格に遵守されなければなりません。

---

#### `README.md`

-   **目的:** プロジェクトの全体像を伝える「顔」。
-   **人間の責務:**
    -   AIから提案された更新内容をレビューし、承認または却下する。
-   **AIの責務:**
    -   開発手順、ビルド方法、デプロイ先、プロジェクトのコンセプトなど、**ゲームのリスト以外の**全体像に影響を与える変更が発生した場合、**セッションの最後に必ず`README.md`の更新が必要か判断し、具体的な変更案を自発的に提案しなければならない。**

---

#### `docs/project-info/human-guide.md` (人間向けガイド)

-   **目的:** 人間がAIとの協業をスムーズに進めるための手引書。
-   **人間の責務:**
    -   AIとの対話方法やワークフローの変更を望む場合、その旨をAIに伝える。
-   **AIの責務:**
    -   人間との対話方法やワークフローに関する変更が議論され合意された場合、**自発的にこのガイドの更新案を提案しなければならない。**

---

#### `docs/ai-workflow/1-project-manifest.md` (憲法)

-   **目的:** プロジェクトの不変の基本理念。
-   **人間の責務:**
    -   **このドキュメントの変更を開始できる唯一の存在である。**
-   **AIの責務:**
    -   人間からの明確な指示があった場合に**のみ**、変更作業を実行する。自発的な変更提案は一切行ってはならない。

---

#### `docs/ai-workflow/2-technical-guide.md` (技術ガイド)

-   **目的:** AIと人間の協業ワークフローを定義する「法律」。
-   **人間の責務:**
    -   ワークフローの変更を望む場合、AIに対してこのドキュメントの更新を指示する。
    -   AIから提案されたルールの更新案をレビューし、承認する。
-   **AIの責務:**
    -   ワークフローに関する新しいルールが議論され合意に至った場合、**その内容を反映させるため、自発的にこのドキュメントの更新を提案しなければならない。**

---

#### `docs/ai-workflow/3-session-context.md` (セッションコンテキスト)

-   **目的:** 短期的な作業記憶。
-   **人間の責務:**
    -   セッション開始時に、`human-guide.md`に記載されたフォーマットに従って、`## 本日の指示`を含むプロンプトを送信する。
-   **AIの責務:**
    -   **このドキュメントの完全な管理責任を負う。**
    -   人間からの開始プロンプトを受け取った際、**直ちに`## 本日の指示`の内容をこのファイルの「現在のタスク」セクションに転記し、タスクを開始しなければならない。**
    -   セッション終了時には必ず最新の状況（ブランチ、進捗）を反映した上でコミットに含めなければならない。

---

#### `docs/project-info/setup-log.md` (セットアップログ)

-   **目的:** プロジェクトの重要な意思決定を記録する「議事録」。
-   **人間の責務:**
    -   AIが提案した議事録の内容をレビューし、正確性を保証する。
-   **AIの責務:**
    -   以下のトピックに関する議論や意思決定が行われた場合、**その議論の背景、選択肢、結論を要約し、ログへの追記を自発的に提案しなければならない。**
        1.  **プロジェクト全体の構造やアーキテクチャに関する変更**
        2.  **開発ワークフロー、ドキュメントルールなど、運用設計に関する変更**
        3.  新しい技術（ライブラリ、ツール等）の導入や設定変更
        4.  その他、将来の参照価値が高いと判断される技術的な課題解決

---

#### 各ゲームの仕様書 (`games/[slug]/*.md`)

-   **目的:** ゲームの動作を定義する「設計図」。
-   **人間の責務:**
    -   新しいゲームの初期仕様を定義する。
    -   AIから提案された仕様変更をレビューし、承認する。
-   **AIの責務:**
    -   実装に着手する前、**必ず関連する仕様書をすべて読み込まなければならない。**
    -   人間からの指示が既存の仕様と矛盾する場合、または仕様に定義されていない場合、**コードを記述する前に、まず仕様書の変更案を提示し、人間の承認を得なければならない。**

---

## 11. ルールの整合性維持と定期的な見直し

プロジェクトのワークフローを定義するルール群（主に `technical-guide.md`）は、常に明確で、矛盾がなく、実行可能でなければならない。そのため、以下の責務を定義する。

-   **目的:** ルールの肥大化、複雑化、矛盾を防ぎ、常に最適な状態に保つ。
-   **人間の責務:**
    -   AIから提案されたルールの整理・統合案をレビューし、承認または却下する。
    -   AIの提案が不十分だと感じた場合、具体的な懸念点を指摘する。
-   **AIの責務:**
    -   **新しいルールの追加や既存ルールの変更を提案する際、必ず以下の「整合性チェックリスト」に基づいて自己検証を行わなければならない。**
    -   検証の結果、矛盾や改善点を発見した場合、**新しいルールの提案と同時に、既存ルールの修正・統合案を併せて提案しなければならない。**

### AIの整合性チェックリスト

1.  **矛盾の検出:** 新しいルールは、既存のどのルールとも矛盾していないか？（例: あるルールではAIの自律的なプッシュを許可し、別のルールでは禁止するなど）
2.  **重複の排除:** 新しいルールは、既存のルールと実質的に同じ内容を別の言葉で表現していないか？
3.  **統合の検討:** 新しいルールは、既存のルールと組み合わせることで、よりシンプルで分かりやすい一つのルールに統合できないか？
4.  **陳腐化の確認:** 新しいルールによって、不要になったり、意味がなくなった古いルールは存在しないか？
5.  **構造の最適化:** ルールを追加した結果、ドキュメントの章立てや構成が分かりにくくならないか？ 必要であれば、セクションの再編成も提案する。

---

## 12. 新規タスク開始時のAIの初期行動

人間から新しいタスクの指示を受けた際、AIは具体的な作業に入る前に、必ず以下のプロセスを実行します。

1.  **ルール確認の明示的な宣言:** 「新しいタスクを開始するにあたり、プロジェクトの技術ガイドに記載されているワークフロー（特にGitワークフローとドキュメント更新責務）を確認します。」と明示的に宣言します。
2.  **関連ルールの自動読み込みと提示:** `docs/ai-workflow/2-technical-guide.md` の「5. GitワークフローとAIの責務」および「10. ドキュメントの所有権と更新責務」セクションを読み込み、その内容を提示します。
3.  **ルールに基づいた行動の提案:** 読み込んだルールに基づき、現在のタスクに最適な次の行動（例: 「技術ガイドによると、新しいタスクはフィーチャーブランチで開始する必要があります。このタスクのために新しいフィーチャーブランチを作成しましょう。」）をプロアクティブに提案します。
