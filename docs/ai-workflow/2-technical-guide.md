# 技術ガイド (TECHNICAL GUIDE)

本ドキュメントは、プロジェクトの技術的なルールと規約を定義します。AIは常にこれらのガイドラインを遵守しなければなりません。

---

# 第一部: プロジェクトセットアップ

このセクションでは、開発環境の構築とプロジェクトの実行に必要な技術情報を記載します。

## 1. 環境構築

### Node.jsバージョン管理
本プロジェクトでは、Node.jsのバージョン管理に`nodenv`を使用しています。`.node-version`ファイルに指定されたバージョンを使用してください。

```bash
# プロジェクトで使用するNode.jsバージョンをインストール
nodenv install

# プロジェクトディレクトリでバージョンを有効化
nodenv local
```

### 依存関係のインストール
プロジェクトのルートディレクトリで、以下のコマンドを実行して依存関係をインストールします。

```bash
npm install
```

## 2. 開発サイクル

### 開発サーバーの起動
以下のコマンドを実行すると、`http://localhost:3000` で開発サーバーが起動します。

```bash
npm run dev
```

### ビルド
本プロジェクトは静的サイトとしてエクスポートされます。以下のコマンドでビルドを実行できます。

```bash
npm run build
```

## 3. 技術スタック
-   **フレームワーク:** Next.js
-   **言語:** TypeScript
-   **スタイリング:** Tailwind CSS (`globals.css` と PostCSS経由)
-   **Node.jsバージョン管理:** `nodenv` (`.node-version` ファイルを参照)
-   **リンティング & フォーマット:** `eslint.config.mjs` に定義されたルールに準拠します。

---

# 第二部: AIとの協業ワークフロー

このセクションでは、人間とAIが円滑に共同開発を進めるためのルールと責務を定義します。

## 4. 基本的なワークフロー (Git & PR)

-   **ブランチ:** 新規タスクの開始時、AIは人間の指示に基づき、適切な名前でフィーチャーブランチを作成します。
-   **コミット:** 作業の区切りで、AIは変更内容を要約したコミットメッセージ（日本語）を作成し、人間の承認を得てコミットを実行します。
-   **プッシュ:** AIは人間の指示に基づき、現在のブランチをリモートにプッシュします。
-   **PR提案:** プッシュが完了した後、AIは作業内容を要約したPRのタイトルと本文を自発的に提案します。
-   **言語:** コミットメッセージ、および本プロジェクトで作成されるすべてのドキュメントは、原則として日本語で記述します。

## 5. セッション管理

本プロジェクトは `docs/ai-workflow/3-session-context.md` を単一エントリーポイントとします。AIは以下の責務を負います。

1.  **コンテキストの参照:** セッション開始時、AIはまず`docs/ai-workflow/3-session-context.md`を読み込み、現状を把握します。詳細情報が必要な場合は、そこからポインタをたどって各ドキュメントを参照します。
2.  **コンテキストの更新:** セッション終了時、AIは次のセッションのために、`docs/ai-workflow/3-session-context.md`を最新の作業状況で更新し、コミットに含めます。

## 6. ログの管理と責務

プロジェクトの透明性と再現性を確保するため、「議事録」と「作業ログ」の2種類のログを管理します。

-   **`docs/project-info/setup-log.md` (議事録):**
    -   **目的:** **なぜ**その決定をしたのか、という**理由**と**背景**を記録する。
    -   **内容:** 設計上のトレードオフ、導入技術の選定理由、ワークフローの変更理由など、将来参照すべきハイレベルな意思決定を記録する。
    -   **AIの責務:** 重要な意思決定が行われたセッションの最後に、その内容を要約し、追記を自発的に提案しなければならない。

-   **`docs/ai-workflow/logs/` (作業ログ):**
    -   **目的:** **なにを**したのか、という具体的な**作業の事実**を時系列で記録する。
    -   **内容:** `system.log`にはプロジェクト全体に関わる作業を、`games/(ゲーム名).log`には特定のゲームに関する作業を記録する。
    -   **AIの責務:** 作業を行った**すべてのセッションの最後**に、その日の作業内容のサマリーを適切なログファイルに追記しなければならない。

-   **ログ追記の厳格な手順:**
    -   ログファイルへの追記を行う際、AIは**必ず**以下の手順を実行しなければならない。ファイルの直接的な上書きによる情報損失は、重大なルール違反とみなす。
        1.  `read_file` で対象ファイルの現在の全内容を読み込む。
        2.  読み込んだ内容の末尾に、新しく記録する内容を文字列として結合する。
        3.  `write_file` を使用し、結合後の文字列でファイル全体を上書きする。

## 7. ドキュメントの所有権と更新責務

各ドキュメントの更新責任は、以下の通り明確に定義されます。

(ここには、以前定義した各ドキュメントごとの詳細なルールが続く...)

## 8. ルールと仕様の参照

-   **ゲーム仕様:** ゲームの実装や修正を開始する前に、AIは必ず対象ゲームのディレクトリ（`games/[slug]/`）に定義された仕様を最初に読み込み、完全に理解しなければなりません。
-   **新規ゲーム開発:** 新しいゲームを開発する際は、まずルールとシステム仕様に関するドキュメントを作成し、人間の承認を得てから実装を開始します。

## 9. ルールの整合性維持

-   AIは、新しいルールを追加・変更する際、既存ルールとの整合性をチェックリストに基づき自己検証し、必要であれば統合・修正案を同時に提案しなければなりません。

## 10. AIの初期行動

人間から新しいタスクの指示を受けた際、AIは具体的な作業に入る前に、必ず関連するワークフロー（特にGitワークフローとドキュメント更新責務）を確認し、その旨を宣言します。

## 11. ドキュメントスタイル規約

本プロジェクトのすべてのドキュメントは、以下のスタイル規約を遵守すること。

-   **文体:** 原則として「敬体（です・ます調）」を使用する。
-   **用語:** プロジェクト内で使用する専門用語は統一し、一貫性を持たせる。
-   **既存ドキュメントの編集:** ドキュメントを編集する際、AIは**必ず**既存の書式（見出しレベル、リスト形式、強調表現など）と文体を分析し、そのスタイルに厳密に従わなければならない。新しいセクションを追加する場合も、そのドキュメントの既存の構造に倣うこと。
