# 決定事項: テストにおけるアサーション方針の標準化

## 日付

2025年8月13日

## 決定事項

プロジェクト全体のテスト（単体テスト、E2Eテスト）において、アサーション（表明）の実装方針を標準化し、タイムアウトに依存しない即時評価を原則とすることを決定する。

## 背景

Playwrightを用いたE2Eテストにおいて、`expect(...).toHaveText(...)` のような自動リトライ機能を持つアサーションを使用していたところ、期待値と実際の結果が異なっていた場合に、エラーとして即時検知されず、設定されたタイムアウト時間（デフォルト5000ms）まで処理が待機してしまう問題が確認された。

この挙動は、ローカルでの開発サイクルを遅延させるだけでなく、CI/CD環境においてエラーの原因特定を困難にする可能性があった。

## 目的

-   **フィードバックの迅速化:** テストが失敗した際に、その原因を即座に開発者にフィードバックし、デバッグサイクルを高速化する。
-   **CI/CDの安定化:** タイムアウトによる不安定要素を排除し、CI/CDパイプラインの信頼性を向上させる。
-   **コードの明確化:** アサーションの意図を明確にし、テストコードの可読性と保守性を高める。

## 方針

1.  **値の取得と直接比較:** `locator.textContent()` や `locator.inputValue()` などのメソッドを用いて、DOMから値を明示的に取得する。
2.  **即時評価マッチャーの使用:** 取得した値を、`vitest` の `expect(...).toBe(...)` や `expect(...).toEqual(...)` のような、リトライ機能を持たないマッチャー（Matcher）で検証する。

この方針は、`docs/rules/technical-guide-development-workflow.md` に正式なルールとして追記された。

## 関連ドキュメント

-   [開発ワークフロー (DEVELOPMENT WORKFLOW)](../../rules/technical-guide-development-workflow.md)
