**日付:** 2025年8月10日

## 目的
E2Eテスト(Playwright)の実行環境を整備し、ローカル開発環境とCI環境の両方で安定して動作するように修正する。また、それに伴い関連ドキュメントを更新し、開発ワークフローを改善する。

## 議論と意思決定の過程

### 1. E2Eテストのローカル実行失敗
- **課題:** 既存のE2Eテストがローカル環境で失敗する。CI上でのみ成功するように調整されており、開発体験を損なっている。
- **原因分析:**
    - `playwright.config.ts` の `webServer` 設定が、ビルド済みの静的ファイル (`out` ディレクトリ) を対象とする `npx serve out -p 3000` になっていた。
    - ローカル開発時は `npm run dev` で開発サーバーを動かすため、テスト対象のコードと `out` ディレクトリの内容に乖離があった。
    - また、Next.jsの `basePath` の扱いが静的サーバーと開発サーバーで異なり、テストが正しいURLにアクセスできていなかった。
- **解決策:** `playwright.config.ts` の `webServer.command` を `npm run dev` に変更。これにより、E2Eテストは常に最新の開発サーバーに対して実行されるようになり、ローカルとCIの環境差異が解消された。

### 2. Playwrightのセットアップ手順の統一
- **課題:** 従来は `npm install` とは別に、手動で `npx playwright install` を実行する必要があった。CIでは実行ステップが定義されていたが、ローカルでは開発者が手順を知らないとテストを実行できない。
- **解決策:** `package.json` の `postinstall` スクリプトを修正し、`npm install` の実行後に `npx playwright install --with-deps` が自動で実行されるようにした。
- **効果:** `npm install` だけでE2Eテストの実行環境が整うようになり、セットアップが簡素化された。この変更に伴い、CIワークフロー (`pr-checks.yml`) からも手動でのインストールステップを削除した。

### 3. 不要な依存関係の削除
- **課題:** `playwright.config.ts` の修正により、`serve` パッケージが不要になった。
- **解決策:** `npm uninstall serve` を実行し、不要な依存関係をプロジェクトから削除した。

### 4. 開発者向けドキュメントの改善
- **課題:** AI（私）が日本語での応答やドキュメント更新といったルールを遵守しない場合がある。
- **解決策:** `human-guide.md` の初期プロンプトテンプレートに、ルール遵守（特に日本語での記述とドキュメント更新）を強く促す一文を追加した。
- **課題:** テスト環境に関する記述が古くなっていた。
- **解決策:** `technical-guide.md` を更新し、`npm install` だけでセットアップが完了することや、ローカルでのテスト実行手順を現状に合わせて修正した。