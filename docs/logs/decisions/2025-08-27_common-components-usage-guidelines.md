# 共通コンポーネント利用ガイドライン策定

## 意思決定の概要

**日付**: 2025-08-27  
**決定者**: 開発チーム  
**影響範囲**: 全ゲーム実装、共通コンポーネント利用

## 背景

リバーシゲームのレスポンシブ対応作業中に、以下の問題が発生しました：

1. **GameLayoutコンポーネントの未使用**: 既存のリバーシゲームがGameLayoutを使用しておらず、レスポンシブ対応が困難
2. **実装パターンの不統一**: ゲームごとに異なる実装パターンが存在
3. **ガイドライン不足**: 共通コンポーネントの使用方法が明文化されていない

これらの問題により、開発効率の低下と品質の不安定化が発生していました。

## 決定内容

### 1. 共通コンポーネント利用ガイドの策定

新しいテクニカルガイド `docs/rules/technical-guide-common-components.md` を作成し、以下を明文化：

- **GameLayoutコンポーネントの必須使用**: 新規ゲーム実装時の必須要件として規定
- **実装パターンの標準化**: GameControllerパターンの採用を必須化
- **トラブルシューティング手順**: よくある問題と解決方法を文書化
- **品質保証プロセス**: 必須テストと手動確認項目を明確化

### 2. 既存ドキュメントの更新

- **アプリケーションアーキテクチャガイド**: 新しいガイドへの参照を追加
- **GEMINI.md**: 参照トリガーを追加して、AI開発者が適切にガイドを参照するよう設定

### 3. 実装パターンの統一

以下のパターンを標準として採用：

```typescript
// 1. GameControllerフックの実装
export function useYourGame(): BaseGameController<YourGameState, YourGameAction> {
  // GameControllerインターフェースに準拠
}

// 2. ゲームコンポーネントでのコントローラー受け取り
interface YourGameProps {
  controller?: YourGameController;
}

// 3. GameClientPageでのGameLayout使用
<GameLayout 
  gameName={manifest.displayName} 
  slug={slug}
  gameController={controller}
>
  <YourGame controller={controller} />
</GameLayout>
```

## 期待される効果

### 1. 開発効率の向上
- 統一されたパターンによる学習コストの削減
- 明確なガイドラインによる迷いの解消
- トラブルシューティング手順による問題解決の迅速化

### 2. 品質の向上
- 一貫したユーザーエクスペリエンスの提供
- レスポンシブ対応の標準化
- テストプロセスの明確化

### 3. 保守性の向上
- 共通コンポーネントの一元管理
- 実装パターンの統一による理解しやすさ
- ドキュメント化による知識の共有

## 実装上の注意点

### 1. 既存ゲームの移行
- 段階的な移行を推奨（一度に全て変更しない）
- 各段階でのテスト実行を必須とする
- 動作確認はPC・モバイル両環境で実施

### 2. 後方互換性
- 既存の動作を破壊しない
- 移行期間中は旧パターンも許容
- 新機能追加時は新パターンを必須とする

### 3. 継続的改善
- ガイドラインは実装経験に基づいて継続的に更新
- 新しい問題が発見された場合は速やかにガイドに反映
- 開発者からのフィードバックを積極的に収集

## 関連ドキュメント

- `docs/rules/technical-guide-common-components.md` - 新規作成
- `docs/rules/technical-guide-architecture.md` - 更新
- `GEMINI.md` - 参照トリガー追加

## 今後のアクション

1. **既存ゲームの段階的移行**: はさみ将棋、アニマルチェス、神経衰弱、棒消しゲーム
2. **ガイドラインの継続的改善**: 実装経験に基づく更新
3. **新機能開発時の適用**: 今後の全ての新機能でガイドライン適用

## 教訓

### 技術的教訓
1. **共通コンポーネントの重要性**: 一貫したUXと開発効率のために不可欠
2. **ドキュメント化の価値**: 明文化されていないルールは守られない
3. **段階的移行の有効性**: 一度に全てを変更するリスクの回避

### プロセス的教訓
1. **早期のガイドライン策定**: プロジェクト初期での標準化の重要性
2. **継続的な改善**: 実装経験に基づく継続的なガイドライン更新
3. **チーム内共有**: ガイドラインの存在と内容の周知徹底