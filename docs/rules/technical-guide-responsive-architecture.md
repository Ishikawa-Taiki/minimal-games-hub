# 技術ガイド - レスポンシブアーキテクチャ

## 1. 概要

本ドキュメントは、本プロジェクトにおけるレスポンシブデザインの技術的なアプローチ、アーキテクチャ、およびコンポーネント構造を定義します。PCでのサイドバーレイアウトと、モバイルでのミニマルレイアウト（FAB + ボトムシート）を基本パターンとし、将来のゲーム開発で効率的かつ一貫性のあるUI/UXを提供することを目的とします。

### 背景と目的

このアーキテクチャは、以下の課題を解決するために設計されました。

-   **画面の圧迫感の解消:** スマートフォン等の狭い画面でも、ゲームボードの表示領域を最大限に確保する。
-   **UI/UXの一貫性:** ゲーム間で統一された操作性を提供し、ユーザーが直感的に学習できるようにする。
-   **開発効率の向上:** ゲーム固有の実装と共通のUI基盤を分離し、保守性と拡張性を高める。

## 2. アーキテクチャ

### 2.1. 基本方針

-   **ブレークポイント:** `768px`を境界とし、それ以上をPC、未満をモバイルと定義します。
-   **レイアウトパターン:**
    -   **PC (>= 768px):** サイドバーレイアウト。コントロールパネルを画面左側に常時表示し、一覧性を確保します。
    -   **モバイル (< 768px):** ミニマルレイアウト。ゲーム盤面を最大化し、操作はフローティングアクションボタン（FAB）とボトムシートを介して行います。
-   **実装技術:** `useResponsive`フックによる動的なレイアウト切り替えと、CSS-in-JS (`StyleSheet.create`) によるスタイリングを基本とします。

### 2.2. 全体構成図

```
┌─────────────────────────────────────────────────────────────┐
│                    Next.js App Router                       │
├─────────────────────────────────────────────────────────────┤
│  Responsive Layout System                                   │
│  ┌─────────────────┐  ┌─────────────────┐                 │
│  │   PC Layout     │  │  Mobile Layout  │                 │
│  │  (Sidebar)      │  │   (Minimal)     │                 │
│  └─────────────────┘  └─────────────────┘                 │
├─────────────────────────────────────────────────────────────┤
│  Common Game Architecture                                   │
│  ┌─────────────────┐  ┌─────────────────┐                 │
│  │ GameController  │  │   GameLayout    │                 │
│  │   Interface     │  │   Component     │                 │
│  └─────────────────┘  └─────────────────┘                 │
├─────────────────────────────────────────────────────────────┤
│  Individual Game Components                                 │
│  ┌─────────────────┐  ┌─────────────────┐                 │
│  │  Game Hooks     │  │  Game UI        │                 │
│  │  (useReversi)   │  │  Components     │                 │
│  └─────────────────┘  └─────────────────┘                 │
└─────────────────────────────────────────────────────────────┘
```

### 2.3. ポリモーフィックなスコア表示

新しいゲームを追加するたびに共通レイアウトコンポーネント（`GameLayout`）を修正する必要がないよう、ポリモーフィックな設計を採用しています。

-   **`getScoreInfo`メソッド:** `BaseGameController`インターフェースにオプショナルな`getScoreInfo`メソッドを定義。
-   **各ゲームの責務:** 各ゲームのコントローラー（カスタムフック）が、自身のゲームのスコアや統計情報の表示形式（`ScoreInfo`型）を決定し、このメソッドを介して`GameLayout`に提供します。
-   **`GameLayout`の責務:** `GameLayout`は提供された`ScoreInfo`を描画することに専念し、ゲーム固有のロジックを持ちません。

この設計に関する詳細な決定経緯は、[ADR-003: ポリモーフィックなスコア表示設計の採用](../../logs/decisions/2025-09-03_polymorphic-score-display-design.md)を参照してください。

## 3. 主要コンポーネントとインターフェース

### 3.1. `useResponsive` フック

このフックは、現在の画面幅に基づいてレイアウトモード (`'mobile'` または `'desktop'`) を返します。

-   **定義:** `hooks/useResponsive.ts`
-   **戻り値:** `ResponsiveState`オブジェクト (`{ layoutMode: 'mobile' | 'desktop', screenWidth: number }`)
-   **利用法:**
    ```typescript
    const responsiveState = useResponsive();

    if (isMobile(responsiveState)) {
      // モバイル用のレンダリング
    } else {
      // PC用のレンダリング
    }
    ```
-   **注意:** このフックはクライアントサイドでのみ動作します。SSR時にはデフォルト値（PC）が返されます。

### 3.2. `GameLayout` コンポーネント

すべてのゲーム画面の共通レイアウトを提供します。`useResponsive`フックの結果に応じて、PC用サイドバーレイアウトとモバイル用ミニマルレイアウトを自動的に切り替えます。

-   **定義:** `app/components/GameLayout.tsx`
-   **主要なProps:**
    -   `gameName`: ゲーム名
    -   `gameController`: 各ゲームのロジックをカプセル化したコントローラーオブジェクト
    -   `children`: ゲーム盤面など、ゲーム固有のUI
-   **責務:**
    -   レスポンシブレイアウトの適用
    -   共通コントロールパネル（ルール、リセット等）の表示
    -   `gameController`から提供される共通の状態（手番、ステータス、スコア等）の表示

### 3.3. `ControlPanel`, `FloatingActionButton`, `BottomSheet`

これらは主にモバイルレイアウトで使用されるコンポーネント群です。

-   **`FloatingActionButton` (FAB):** 画面右下に表示され、タップするとボトムシートを開きます。
-   **`BottomSheet`:** 画面下からスライドアップするモーダル。内部に`ControlPanel`をホストします。
-   **`ControlPanel`:** ゲームの操作ボタン（ルール、リset）やスコア情報を表示します。PCレイアウトではサイドバー内に直接表示されます。

## 4. 型定義

関連する主要な型は `types/game.ts` に集約されています。

-   **`GameStatus`, `Player`, `BaseGameState`:** すべてのゲームで共通の基本的な状態。
-   **`BaseGameController`:** すべてのゲームコントローラーが準拠すべき共通インターフェース。`gameState`, `resetGame`, `getDisplayStatus`, `getScoreInfo`などが定義されています。
-   **`ScoreInfo`:** `getScoreInfo`メソッドが返すスコア/統計情報のデータ構造。

新しいゲームを実装する際は、これらの共通型を継承し、ゲーム固有の状態やアクションを追加します。詳細は`technical-guide-application-architecture.md`を参照してください。

## 5. 実装ガイドライン

新しいゲームをレスポンシブ対応させる、または新しいレスポンシブコンポーネントを作成する際は、以下の原則に従ってください。

-   **`useResponsive`フックを利用する:** レイアウトの分岐は必ずこのフックを基準に行います。
-   **`StyleSheet.create`を使用する:** スタイリングは既存のCSS-in-JSアプローチを踏襲します。
-   **共通コンポーネントを再利用する:** `Button`, `Modal`など、`app/components/ui/`に用意された共通UIコンポーネントを最大限活用します。
-   **タッチフレンドリーな設計:** モバイルでの操作を考慮し、ボタン等のインタラクティブ要素は十分な大きさ（最低44x44px）を確保します。
