# 技術ガイド - ヒント機能仕様 (spec-hint.md)

## 1. 概要

本ドキュメントは、プロジェクト内の全ゲームに共通する「ヒント機能（おしえて！機能）」の仕様と、その実装に関するルールを定義します。

ヒント機能の目的は、プレイヤーの学習を支援し、ゲームの戦略的側面への理解を深めることにあります。各ゲームの特性に合わせて、異なる種類のヒントが提供されます。

## 2. manifest.jsonにおけるヒント定義

各ゲームのヒントに関する設定は、それぞれの `manifest.json` ファイル内で `hints` プロパティとして管理されます。これにより、ゲームのロジックからヒントの定義を分離し、一元的な管理を可能にします。

### 2.1. `hints` プロパティの構造

`hints` プロパティは、そのゲームで提供されるヒントの種類を定義するオブジェクトの配列です。各オブジェクトは以下のキーを持ちます。

-   `id` (string): ヒントの種類を一意に識別するためのIDです。ゲームロジック内で参照されます。(例: `placeable-cells`, `danger-zone`)
-   `title` (string): ヒントのタイトルです。UI上でヒント機能の説明などに使用されます。
-   `description` (string): ヒントの具体的な内容を説明する文章です。
-   `level` (string): ヒントの提供レベルを定義します。
    -   `base`: ヒント機能のON/OFFに関わらず、常に表示される基本的な操作補助ヒント。
    -   `strategy`: ヒント機能がONの場合にのみ表示される、戦略的なヒント。

### 2.2. `hints` プロパティの記述例 (リバーシ)

```json
"hints": [
  {
    "id": "placeable-cells",
    "title": "石を置ける場所",
    "description": "現在の手番で、あなたが石を置くことができる全てのマスを、半透明のあなたの色の石で示します。",
    "level": "base"
  },
  {
    "id": "flip-count",
    "title": "獲得できる数",
    "description": "「おしえて！」がONの時、石を置けるマスに、裏返せる相手の石の数が数字で表示されます。",
    "level": "strategy"
  },
  {
    "id": "preview-flip",
    "title": "プレビュー機能",
    "description": "「おしえて！」がONの時、数字が表示されたマスを選択すると、実際に裏返る相手の石がプレビューとしてハイライトされます。もう一度同じマスを選択すると、その手が確定されます。",
    "level": "strategy"
  }
]
```

## 3. 各ゲームのヒント機能仕様

以下に、各ゲームで実装されるヒント機能の詳細な仕様を記述します。

### 3.1. リバーシ

-   **基本ヒント (level: `base`)**
    -   `placeable-cells`: 現在の手番プレイヤーが石を置けるすべてのマスに、半透明の石が表示されます。
-   **戦略ヒント (level: `strategy`)**
    -   `flip-count`: 上記のヒント表示に加えて、各ヒントマスに、そのマスに石を置いた場合に裏返せる相手の石の数が、数字で表示されます。
    -   `preview-flip`: プレイヤーがヒントマスを一度選択すると、実際に裏返る相手の石がプレビューとしてハイライト表示されます。

### 3.2. はさみ将棋

-   **基本ヒント (level: `base`)**
    -   `movable-pieces`: 現在手番のプレイヤーが操作できる全ての駒が、薄い白色で常に強調表示されます。
    -   `selected-piece`: プレイヤーが自分の駒を1つ選択すると、その駒の背景色が黄色などでハイライトされ、選択中であることが示されます。
-   **戦略ヒント (level: `strategy`)**
    -   `safe-moves`: 選択中の駒が移動でき、かつ次の相手の手番で取られる心配のないマスが、緑色でハイライトされます。
    -   `danger-moves`: 選択中の駒が移動できるものの、移動すると次の相手の手番で取られてしまうマスが、赤色でハイライトされます。
    -   `potential-captures`: 選択中の駒をいずれかのマスに動かした場合に、捕獲できる可能性のある相手の駒すべてが、水色でハイライトされます。

### 3.3. アニマルチェス

-   **基本ヒント (level: `base`)**
    -   `movable-pieces`: 操作可能な自分の駒が存在するマスは、薄い白色でハイライトされます。
    -   `movable-squares`: 駒を選択すると、その駒が移動できるマスが薄い白色でハイライトされます。
-   **戦略ヒント (level: `strategy`)**
    -   `capture-squares`: 移動先に相手の駒がいて捕獲できる場合、そのマスは薄紫色でハイライトされます。
    -   `danger-squares`: あるマスへ移動すると次の相手の手番で取られてしまう場合、そのマスは薄赤色で示唆されます。
    -   `danger-drop-squares`: 持ち駒を選択している場合、配置すると次の相手の手番で取られてしまうマスが、薄赤色で示唆されます。
    -   `threatened-pieces`: 次の相手の手番で取られる可能性がある自分の駒が存在するマスが、薄青色でハイライトされます。

### 3.4. 棒消しゲーム

-   **戦略ヒント (level: `strategy`)**
    -   `chunk-visualization`: 各段に残っている連続した棒の「塊」が、半透明の色のついた四角形で囲まれ、視覚的にグループ化されます。
    -   `chunk-length`: 各塊のグループの下に、その塊の長さが表示されます。

### 3.5. ○×ゲーム

-   **戦略ヒント (level: `strategy`)**
    -   `reach-squares`: 次にマークを置けば勝利できるマスが、特別な色で強調表示されます（○なら赤、×なら青、両方なら黄色）。
    -   `potential-lines`: 空いている各マスに、そのマスにマークを置いた場合に形成できる有効なラインの数が、薄いグレーの数値で表示されます。

### 3.6. 神経衰弱

-   **戦略ヒント (level: `strategy`)**
    -   `known-cards`: 過去に一度以上表向きにされたが、まだマッチしていないカードが、薄い黄色でハイライトされます。
    -   `potential-pairs`: 上記の既知カードの中で、同じ数字を持つものが2枚以上含まれている場合、それらのカードは薄い緑色でより強くハイライトされます。