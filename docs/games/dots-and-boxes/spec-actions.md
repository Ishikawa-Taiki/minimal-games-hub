# ドット＆ボックス アクション仕様

このドキュメントは、ドット＆ボックスゲームにおけるユーザーのアクションと、それに伴う状態遷移の仕様を定義します。

## 1. ゲームのライフサイクル

### 1.1. ゲーム開始

1.  **初期状態**: `status`が`'waiting'`。
2.  **アクション**: ユーザーが難易度選択画面で「かんたん」「ふつう」「むずかしい」のいずれかのボタンをクリックします。
3.  **状態遷移**:
    -   `setDifficulty`アクションが実行されます。
    -   選択された難易度に応じて`createInitialState`が呼び出され、新しいゲームボードが生成されます。
    -   `status`が`'playing'`に更新されます。
    -   `currentPlayer`が`'player1'`に設定されます。

### 1.2. ゲーム進行

1.  **初期状態**: `status`が`'playing'`。
2.  **アクション**: 現在のプレイヤーが、まだ選択されていないラインをクリックします。
3.  **状態遷移**:
    -   `selectLine`アクションが実行されます。
    -   クリックされたラインの`owner`が現在のプレイヤーに設定されます。
    -   **ボックスが完成しない場合**:
        -   `currentPlayer`が相手プレイヤーに切り替わります。
    -   **ボックスが完成した場合**:
        -   完成したボックスの`owner`が現在のプレイヤーに設定されます。
        -   `scores`が更新されます。
        -   `currentPlayer`は**切り替わらず**、同じプレイヤーが続けて手番を行います。
    -   全てのラインが埋まると、`status`が`'ended'`に更新され、勝敗判定が行われます。

### 1.3. ゲーム終了

1.  **トリガー**: 全てのラインが埋まる（`remainingLines`が`0`になる）。
2.  **状態遷移**:
    -   `status`が`'ended'`に設定されます。
    -   `scores`を比較し、`winner`プロパティに勝者（`'player1'`, `'player2'`）または`'draw'`が設定されます。
    -   この状態変更をトリガーとして、UI側でリザルトダイアログが表示されます。

## 2. コントロールパネルのアクション

### 2.1. リセット

1.  **アクション**: ユーザーがコントロールパネル内の「リセット」ボタンをクリックします。
2.  **状態遷移**:
    -   `resetGame`アクションが実行されます。
    -   `status`が`'waiting'`にリセットされ、難易度選択画面に戻ります。
    -   ゲームの状態（ボード、スコアなど）はすべて初期化されます。

### 2.2. ヒント（おしえて！）

1.  **アクション**: ユーザーがコントロールパネル内の「おしえて！」ボタンをトグルします。
2.  **状態遷移**:
    -   `setHints`アクションが実行されます。
    -   `hintsEnabled`プロパティが`true`/`false`に切り替わります。
    -   UI側では、この状態に応じてヒントの表示/非表示が切り替わります。

## 3. ダイアログのアクション

### 3.1. リザルトダイアログ

1.  **アクション**: ゲーム終了時に表示されたリザルトダイアログの「OK」ボタンをユーザーがクリックします。
2.  **状態遷移**:
    -   ダイアログが閉じられます。
    -   `resetGame`アクションが実行され、難易度選択画面に戻ります。